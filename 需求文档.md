# 图片水印添加程序需求文档

## 项目概述
开发一个Java命令行程序，用于为图片添加基于EXIF拍摄时间信息的水印。

## 功能需求

### 1. 输入处理
- 程序接受一个图片文件路径作为命令行参数
- 支持读取指定路径下的所有图片文件
- 支持常见图片格式：JPG、JPEG、PNG等

### 2. EXIF信息读取
- 读取图片文件的EXIF元数据
- 提取拍摄时间信息（DateTimeOriginal字段）
- 从拍摄时间中提取年月日信息，格式为：YYYY年MM月DD日
- 如果EXIF信息中不存在拍摄时间，使用文件修改时间作为备选

### 3. 水印配置选项
用户可通过命令行参数设置：
- 字体大小：默认14pt，可自定义
- 字体颜色：支持RGB颜色值或常见颜色名称，默认黑色
- 水印位置：支持以下预设位置：
  - 左上角（TOP_LEFT）
  - 右上角（TOP_RIGHT）
  - 左下角（BOTTOM_LEFT）
  - 右下角（BOTTOM_RIGHT）
  - 居中（CENTER）
- 透明度：可选设置水印透明度

### 4. 水印绘制
- 将提取的时间文本绘制到图片上
- 支持抗锯齿处理确保文字清晰度
- 自动调整水印位置避免超出图片边界
- 保持原图片质量不变

### 5. 输出处理
- 在原图片所在目录下创建"原目录名_watermark"子目录
- 保存处理后的图片到新目录
- 保持原文件名，添加格式后缀（如：image_watermark.jpg）
- 支持批量处理目录下的所有图片文件

## 技术需求

### 依赖库
- Java 8或更高版本
- Apache Commons Imaging（用于EXIF读取）
- 或使用metadata-extractor库
- Java AWT/Swing用于图像处理

### 命令行参数格式
```
java -jar PhotoWatermark.jar [选项] <图片路径>

选项：
  -s, --size <大小>        字体大小（默认：14）
  -c, --color <颜色>       字体颜色（默认：black）
  -p, --position <位置>    水印位置（默认：BOTTOM_RIGHT）
  -o, --opacity <透明度>   水印透明度（0-100，默认：100）
  -h, --help              显示帮助信息
```

### 错误处理
- 处理无效的图片路径
- 处理不支持的文件格式
- 处理EXIF读取错误
- 提供清晰的错误信息

## 输出示例

输入目录结构：
```
photos/
  ├── image1.jpg
  ├── image2.png
  └── vacation.jpeg
```

输出目录结构：
```
photos/
  ├── image1.jpg
  ├── image2.png
  ├── vacation.jpeg
  └── photos_watermark/
        ├── image1_watermark.jpg
        ├── image2_watermark.png
        └── vacation_watermark.jpeg
```

## 测试用例

### 用例1：基本功能
- 输入：包含EXIF信息的JPG图片
- 预期：成功提取时间并添加水印

### 用例2：无EXIF信息
- 输入：不含EXIF信息的PNG图片
- 预期：使用文件修改时间作为水印

### 用例3：批量处理
- 输入：包含多个图片文件的目录
- 预期：所有图片都被处理

### 用例4：自定义设置
- 输入：带自定义字体大小和颜色的图片
- 预期：水印按指定样式添加

## 开发计划

### 阶段1：核心功能
- EXIF信息读取实现
- 基本水印绘制功能
- 单文件处理

### 阶段2：增强功能
- 批量处理支持
- 自定义配置选项
- 错误处理完善

### 阶段3：优化
- 性能优化
- 用户体验改进
- 文档完善

## 注意事项
- 确保处理大图片时的内存效率
- 支持跨平台运行
- 提供详细的日志输出
- 保持代码可维护性和可扩展性